<head>
<title>Simple Faction List</title>
<script type="text/javascript">
var opts = {
  method: 'GET',      
  headers: {},
  cache: 'no-store'
};
var api_key;
var list;
var sts;
var found = false;
function createItem(text) {
    let p = document.createElement('p');
    p.innerHTML = text;
    return p;
} 
function init() {
api_key = document.getElementById("api_key");
list = document.getElementById("list");
sts = document.getElementById("sts");
faction_id = document.getElementById("faction_id");
}
function update() {
list.innerHTML="";
sts.innerHTML="Updating";
let url = "https://api.torn.com/faction/"+faction_id.value+"?selections=basic&key="+api_key.value+"&cache_control="+new Date().getTime();
console.log(url);
fetch(url, opts).then(function (response) { 
return response.json();
}).then(function (body) {
found = false;
for (fighter in body.members) {
let la = body.members[fighter].last_action.status;
let hosp = body.members[fighter].status.details;

if(la=="Online"&&hosp.includes("Hospitalized")) {
list.appendChild(createItem("<a href=https://www.torn.com/profiles.php?XID="+fighter+" target=\"_blank\">"+body.members[fighter].name+"</a>"));
found = true;
}
}
sts.innerHTML="Done";
if(!found){
sts.innerHTML="None Found";
}
});
}
window.onload = function() {
    init();
};
</script>
</head>
<body>
<input id="api_key" placeholder="api_key"/>
<input id="faction_id" placeholder="faction Id"/>
<button onclick="update()">Update</button>
<p id="sts"></p>
<div id="list">
</div>
</body>
